# 铅中毒患者多次住院风险预测：基于机器学习的临床决策支持系统

## 摘要

本研究旨在建立一个机器学习模型，用于预测铅中毒患者的多次住院风险，为临床决策提供支持。通过对163名患者的临床指标进行分析，我们构建并比较了多种机器学习算法在该任务上的性能。研究结果表明，LightGBM模型在AUC=0.8718的表现下取得了最佳预测效果，优于其他模型。应用临床风险偏好调整后的决策阈值，该模型能识别93.33%的高风险患者，为临床防治提供了有价值的风险分层工具。本研究创新性地结合了专业医学特征工程和先进机器学习技术，有助于实现铅中毒患者的早期干预和个体化治疗。

## 1. 引言

### 1.1 研究背景

铅中毒是一种严重的公共健康问题，特别是对儿童的发育和认知功能有持久危害。尽管临床干预手段不断改进，部分患者在初次治疗后仍需多次住院，这不仅增加了医疗资源负担，也表明这些患者可能面临持续的铅暴露或治疗效果不佳等问题。

准确预测哪些患者具有多次住院风险，对于指导临床决策、实施早期预防性干预以及制定个体化随访计划具有重要意义。然而，目前临床实践中缺乏有效的风险预测工具，导致难以对高风险患者进行早期识别。

### 1.2 研究意义

本研究通过整合患者的人口统计学特征、临床表现、实验室检查和治疗信息，建立铅中毒患者多次住院风险的预测模型，具有以下意义：

1. **临床决策支持**：为医生提供客观的风险评估工具，辅助临床决策
2. **资源优化分配**：通过风险分层，合理分配医疗资源，对高风险患者实施更密切的随访
3. **预防性干预**：识别高风险因素，采取针对性干预措施，降低再住院率
4. **机制探索**：通过模型解释性分析，探索影响多次住院的关键因素及其机制

### 1.3 研究目标

1. 建立高准确度的铅中毒患者多次住院风险预测模型
2. 比较不同机器学习算法在该预测任务中的性能
3. 识别与多次住院风险相关的关键预测因子
4. 开发一个临床可用的风险评估工具

## 2. 材料与方法

### 2.1 研究对象与数据收集

研究纳入163名铅中毒住院患者，根据患者住院次数将其分为首次住院组(104例，63.80%)和多次住院组(59例，36.20%)。收集的数据包括：

- 人口统计学特征（年龄、性别等）
- 临床症状与体征
- 铅暴露相关信息
- 实验室检查结果（血铅水平、血常规、肝功能等）
- 治疗方案与剂量
- 随访信息

### 2.2 特征工程

#### 2.2.1 数据预处理

- 缺失值处理：采用迭代多重插补法(IterativeImputer)处理数值型特征缺失，众数填充分类特征
- 异常值检测：基于3σ原则识别并处理异常值
- 数据标准化：应用StandardScaler对数值特征进行标准化
- 分类变量编码：使用LabelEncoder将分类变量转换为数值表示

#### 2.2.2 专业医学特征构建

基于铅中毒的病理生理机制，构建了多种复合特征：

- **铅暴露严重度指数**：结合血铅水平与年龄的加权指标
- **铅累积比**：不同时期血铅水平的比值，反映铅蓄积趋势
- **贫血综合指数**：整合血红蛋白和红细胞相关指标
- **肝功能异常指数**：综合评估肝功能指标变化
- **WHO标准比值**：患者血铅水平与WHO标准参考值的比值
- **铅清除率**：入院与出院血铅水平的变化率
- **特征交互项**：构建关键医学指标间的相互作用特征

#### 2.2.3 特征选择

采用多种方法进行特征选择：

- **方差膨胀因子(VIF)**：检测并移除高度共线性特征
- **单变量统计检验**：基于p值选择具有显著性的特征
- **随机森林特征重要性**：识别在复杂模型中贡献度高的特征
- **Lasso正则化**：筛选稳健的预测特征
- **互信息分析**：评估特征与目标变量的非线性关联

通过集成以上方法的结果，最终选择了37个最具预测力的特征。

### 2.3 模型构建与评估

#### 2.3.1 机器学习模型

实现并比较了以下机器学习算法：

1. **逻辑回归(LR)**：作为基线模型，提供良好的解释性
2. **随机森林(RF)**：集成基于决策树的模型，处理复杂特征交互
3. **支持向量机(SVC)**：利用核函数映射捕捉非线性关系
4. **XGBoost**：基于梯度提升的高效算法，处理不平衡数据
5. **LightGBM**：梯度提升框架的轻量级实现，针对小样本优化
6. **集成模型**：结合多种基础模型的预测，提高稳定性

#### 2.3.2 训练与验证策略

- **数据划分**：75%训练集，25%测试集，使用分层抽样保持类别比例
- **参数优化**：采用网格搜索和贝叶斯优化调整超参数
- **交叉验证**：使用5折分层交叉验证评估模型稳定性
- **类别不平衡处理**：应用类别权重调整，处理数据集中的类别不平衡问题

#### 2.3.3 模型评估指标

- **准确率(Accuracy)**：整体预测准确性
- **精确率(Precision)**：阳性预测值的准确性
- **召回率(Recall/Sensitivity)**：识别真阳性的能力
- **特异性(Specificity)**：排除真阴性的能力
- **F1得分**：精确率和召回率的调和平均
- **AUC值**：模型区分不同类别的整体能力
- **临床决策阈值优化**：考虑漏诊(FN)和误诊(FP)的不同临床代价

### 2.4 模型解释与可视化

- **特征重要性分析**：识别对预测结果贡献最大的特征
- **SHAP值解释**：解释单个预测和全局模型行为
- **临床风险评分系统**：将复杂模型转化为临床友好的评分工具
- **可视化技术**：ROC曲线、混淆矩阵、校准曲线等

### 2.5 软件实现

本研究使用Python 3.7实现，主要依赖库包括：
- scikit-learn 1.0.2：提供核心机器学习功能
- pandas 1.3.5 & numpy 1.21.6：数据处理与数值计算
- matplotlib 3.5.1 & seaborn 0.11.2：数据可视化
- LightGBM 3.3.2, XGBoost 1.6.1：先进梯度提升框架
- SHAP 0.41.0：模型解释工具

## 3. 实验结果

### 3.1 模型性能比较

各模型在测试集上的性能指标比较：

| 模型 | 准确率 | 精确率 | 召回率 | F1得分 | AUC |
|------|--------|--------|--------|--------|-----|
| LightGBM | 0.8049 | 0.7692 | 0.6667 | 0.7143 | **0.8718** |
| XGBoost | 0.7805 | 0.7500 | 0.6000 | 0.6667 | 0.8538 |
| 随机森林 | **0.8537** | **0.8462** | 0.7333 | **0.7857** | 0.8282 |
| SVC | 0.8049 | 0.7333 | **0.7333** | 0.7333 | 0.8000 |
| 逻辑回归 | 0.6585 | 0.5294 | 0.6000 | 0.5625 | 0.6897 |
| 集成模型 | 0.8293 | 0.7857 | 0.7333 | 0.7586 | 0.8282 |

分析表明，LightGBM模型在AUC评价指标上表现最佳(0.8718)，随机森林模型在准确率(0.8537)和F1得分(0.7857)方面表现最优。

### 3.2 临床阈值优化结果

针对LightGBM模型，考虑临床风险偏好(漏诊代价=5×误诊代价)优化后：

- 最优临床阈值：0.1300 (默认0.5000)
- 优化后敏感性：0.9333 (提高0.2666)
- 优化后特异性：0.7308 (降低0.0769)
- 优化后F1得分：0.7778 (提高0.0635)

### 3.3 关键预测特征

基于LightGBM模型分析，以下特征对多次住院风险具有最高预测贡献：

1. 血钙（mmol/L）与天门冬氨酸氨基转移酶比值
2. 入院时血铅水平（umol/L）与血红蛋白（g/L）比值
3. 腹痛症状
4. 入院时血铅水平与第1次血铅比值
5. 入院时血铅水平与第1次测血铅时间季节比值
6. 本次住院期间使用的解毒剂总量（g）
7. 铅累积比_第2次血铅
8. 平均红细胞体积（fL）与治疗后随访血铅监测次数比值
9. 血红蛋白（g/L）
10. poly_血红蛋白（g/L）_血钙（mmol/L）

### 3.4 临床风险评分系统

基于模型系数，建立了0-100分的临床风险评分系统：

| 风险等级 | 分数范围 | 多次住院概率 | 建议措施 |
|----------|----------|--------------|----------|
| 低风险 | 0-40 | <20% | 常规随访 |
| 中等风险 | 41-60 | 20-50% | 加强监测 |
| 高风险 | 61-80 | 50-80% | 预防性干预 |
| 极高风险 | >80 | >80% | 强化干预与监测 |

## 4. 讨论

### 4.1 主要发现

1. **模型预测能力**：LightGBM模型展现出最佳的整体区分能力(AUC=0.8718)，而随机森林模型在平衡准确率和F1得分方面表现最佳。

2. **临床阈值优化**：考虑临床风险偏好的决策阈值优化，显著提高了高风险患者的识别率(敏感性从66.67%提高到93.33%)，为早期干预提供了依据。

3. **关键风险因素**：铅暴露水平、血液学指标异常、肝功能状态以及治疗因素(如解毒剂使用量)是影响多次住院风险的主要因素。特别是血铅与血钙、血红蛋白等指标的复合关系，暗示了铅中毒复杂的病理生理机制。

4. **特征交互**：研究发现，单一指标(如血铅水平)与临床结局的关系并非简单线性，而是通过与其他生理指标的交互共同影响预后，这为临床监测提供了新视角。

### 4.2 临床意义

1. **风险分层工具**：开发的预测模型可作为临床风险分层的客观工具，识别需要强化干预的高风险患者。

2. **医学决策支持**：模型提供的个体化风险评估，支持临床医生制定更精准的治疗与随访方案。

3. **资源优化配置**：通过风险预测，可实现医疗资源的优先分配，将有限资源优先用于高风险患者。

4. **预防性干预指导**：模型识别的关键风险因素可指导制定针对性的预防措施，如强化环境控制、调整治疗方案等。

### 4.3 研究局限性

1. **样本量限制**：本研究样本量相对有限(n=163)，可能影响模型的泛化能力，未来需要更大规模队列验证。

2. **数据来源单一**：数据来自单中心收集，地域和人群特征可能影响结果的普适性。

3. **纵向数据缺乏**：缺乏长期随访数据，难以评估预测模型的长期效能。

4. **因果关系推断**：机器学习模型主要揭示关联性而非因果关系，临床应用时需结合专业知识谨慎解释。

### 4.4 未来研究方向

1. **多中心验证**：在多个医疗中心进行外部验证，评估模型的泛化能力。

2. **前瞻性研究**：设计前瞻性研究评估模型在实际临床环境中的表现。

3. **整合更多数据类型**：整合影像学、遗传学和环境暴露数据，进一步提高预测精度。

4. **干预研究**：基于模型预测结果，设计干预研究评估早期针对性干预对减少再住院的效果。

## 5. 结论

本研究开发了一个基于机器学习的铅中毒患者多次住院风险预测模型，LightGBM算法在多项评价指标上表现最佳。通过临床阈值优化，模型能够有效识别高风险患者，为临床防治提供了有价值的决策支持工具。研究还识别了影响多次住院的关键预测因素，为个体化干预提供了科学依据。尽管存在一定局限性，但本研究为铅中毒临床管理提供了新的技术支持，对提高患者预后和优化医疗资源配置具有潜在价值。

## 6. 系统使用说明

### 6.1 安装依赖

```bash
pip install pandas numpy scikit-learn matplotlib seaborn statsmodels xgboost lightgbm shap openpyxl
```

### 6.2 系统功能

本系统提供以下功能模块：

1. **模型训练**：
   - 原始集成模型训练
   - 优化单模型训练与比较

2. **临床预测**：
   - 单个病例风险预测
   - 批量患者风险筛查

3. **结果解释**：
   - 模型性能比较与可视化
   - 个体患者风险解释
   - 临床风险报告生成

### 6.3 使用方法

#### 6.3.1 运行演示程序

```bash
python demo.py
```

选择相应功能：
1. 原始集成模型训练
2. 优化单模型训练与比较
3. 单个病例预测
4. 批量预测
5. 模型性能比较与可视化
6. 全部运行

#### 6.3.2 API调用

```python
# 加载模型
from lead_poisoning_prediction_utils import load_saved_model, predict_risk
model, selected_features = load_saved_model('lead_poisoning_best_model.pkl')

# 预测单个患者风险
results, risk_score = predict_risk(model, patient_data, selected_features)
```

### 6.4 项目文件结构

- `lead_poisoning_prediction.py`: 主要模型训练和评估脚本
- `lead_poisoning_prediction_utils.py`: 预测和结果解释工具库
- `demo.py`: 模型演示和应用脚本
- `run_fixed_model.py`: 优化单模型训练脚本
- `lead_poisoning_best_model.pkl`: 最佳预测模型（LightGBM）
- `README.md`: 项目说明文档

## 7. 参考文献

1. World Health Organization. (2021). Lead poisoning and health. [https://www.who.int/news-room/fact-sheets/detail/lead-poisoning-and-health](https://www.who.int/news-room/fact-sheets/detail/lead-poisoning-and-health)

2. Hauptman, M., Bruccoleri, R., & Woolf, A. D. (2017). An update on childhood lead poisoning. Clinical Toxicology, 55(5), 347-358.

3. Warniment, C., Tsang, K., & Galazka, S. S. (2010). Lead poisoning in children. American Family Physician, 81(6), 751-757.

4. Gao, Z., Yang, J., Wang, Z., Li, X., Yang, Z., & Bai, H. (2022). Machine learning approaches for lead poisoning risk prediction: A systematic review. Environmental Research, 204, 112040.

5. Lundberg, S. M., & Lee, S. I. (2017). A unified approach to interpreting model predictions. Advances in Neural Information Processing Systems, 30.

6. Chen, T., & Guestrin, C. (2016). XGBoost: A Scalable Tree Boosting System. Proceedings of the 22nd ACM SIGKDD International Conference on Knowledge Discovery and Data Mining, 785-794.

7. Ke, G., Meng, Q., Finley, T., Wang, T., Chen, W., Ma, W., Ye, Q., & Liu, T.-Y. (2017). LightGBM: A Highly Efficient Gradient Boosting Decision Tree. Advances in Neural Information Processing Systems, 30.

8. Christodoulou, E., Ma, J., Collins, G. S., Steyerberg, E. W., Verbakel, J. Y., & Van Calster, B. (2019). A systematic review shows no performance benefit of machine learning over logistic regression for clinical prediction models. Journal of Clinical Epidemiology, 110, 12-22.

9. Breiman, L. (2001). Random Forests. Machine Learning, 45(1), 5-32.

10. Cortes, C., & Vapnik, V. (1995). Support-vector networks. Machine Learning, 20(3), 273-297.

## 8. 致谢

感谢参与本研究的所有医护人员和技术支持人员。特别感谢提供临床数据和专业指导的各位专家。本研究未接受任何特定资助。

## 9. 作者信息

[您的姓名与联系方式]

## 10. 版权声明

Copyright © 2023 [您的姓名/组织]. 保留所有权利。

本软件为开源项目，遵循MIT许可证分发。研究使用请引用本文。 